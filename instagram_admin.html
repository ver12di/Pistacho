<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Instagram 发布控制台</title>
    <meta name="description" content="Pistacho 超级管理员通过模板将点评评论一键同步到 Instagram。" />
    <link rel="icon" type="image/png" href="Certifiedstamp.png" />

    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin />
    <link rel="preconnect" href="https://unpkg.com" crossorigin />
    <script src="https://cdn.tailwindcss.com" defer></script>
    <script src="https://unpkg.com/i18next/i18next.min.js" defer></script>
    <script src="https://unpkg.com/i18next-http-backend/i18nextHttpBackend.min.js" defer></script>
    <script src="https://unpkg.com/i18next-browser-languagedetector/i18nextBrowserLanguageDetector.min.js" defer></script>
    <script type="module" src="scripts/navbar.js"></script>
    <script>
        window.tailwind = window.tailwind || {};
        window.tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans SC', 'system-ui', 'sans-serif'],
                    },
                },
            },
        };
    </script>
    <style>
        .lang-button { padding: 2px 8px; margin: 0 2px; border: 1px solid transparent; border-radius: 9999px; cursor: pointer; font-size: 0.75rem; font-weight: 600; background-color: #f3f4f6; color: #374151; transition: all 0.2s ease; }
        .lang-button:hover { background-color: #e5e7eb; }
        .lang-button.active { background-color: #e0e7ff; border-color: #a5b4fc; color: #3730a3; cursor: default; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div class="px-4 sm:px-6 lg:px-8 pt-4">
        <div class="mx-auto max-w-7xl">
            <div data-include-nav data-active="instagram" data-language="flags"></div>
        </div>
    </div>

    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-10">
        <header class="mb-6">
            <h1 class="text-2xl font-bold text-slate-900" data-i18n="instagramConsolePage.title">Instagram 发布控制台</h1>
            <p class="mt-2 text-sm text-slate-600" data-i18n="instagramConsolePage.description">超级管理员可以在此挑选评论、应用模板，并直接发布到 Instagram。</p>
        </header>

        <div id="auth-guard" class="mb-6 hidden rounded-xl border border-amber-200 bg-amber-50 p-4 text-amber-800 text-sm">
            <p data-i18n="common.loginRequired">请先登录。</p>
        </div>

        <div id="console-wrapper" class="space-y-6 hidden">
            <section class="grid grid-cols-1 gap-6 lg:grid-cols-2">
                <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
                    <div class="flex items-center justify-between gap-2">
                        <div>
                            <h2 class="text-lg font-semibold" data-i18n="instagramConsolePage.templateTitle">发布模板</h2>
                            <p class="text-sm text-slate-500" data-i18n="instagramConsolePage.templateDescription">可用占位符…</p>
                        </div>
                        <button id="save-template" class="rounded-full bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-indigo-500 transition" data-i18n="common.save">保存</button>
                    </div>
                    <textarea id="template-editor" class="mt-3 w-full rounded-lg border border-slate-200 bg-slate-50 p-3 text-sm focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-200" rows="10" placeholder="{{title}}\n{{comment}}" data-i18n="[placeholder]instagramConsolePage.templatePlaceholder"></textarea>
                    <p id="template-status" class="mt-2 text-xs text-slate-500"></p>
                </div>

                <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
                    <div class="flex items-center justify-between gap-2">
                        <div>
                            <h2 class="text-lg font-semibold" data-i18n="instagramConsolePage.ratingLoaderTitle">选择要发布的点评</h2>
                            <p class="text-sm text-slate-500" data-i18n="instagramConsolePage.ratingMeta">点评信息</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <input id="rating-id" type="text" class="w-40 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-200" placeholder="rating id" />
                            <button id="load-rating" class="rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500 transition" data-i18n="instagramConsolePage.loadRating">加载点评与评论</button>
                        </div>
                    </div>
                    <div id="rating-summary" class="mt-3 space-y-1 text-sm text-slate-700"></div>
                    <div class="mt-4">
                        <h3 class="text-sm font-semibold text-slate-800" data-i18n="instagramConsolePage.commentsTitle">选择要发布的评论</h3>
                        <div id="comments-list" class="mt-2 max-h-64 space-y-2 overflow-y-auto"></div>
                        <p id="comments-empty" class="hidden text-sm text-slate-500" data-i18n="instagramConsolePage.noComments">暂无评论，先换一个点评试试。</p>
                    </div>
                </div>
            </section>

            <section class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
                <div class="flex items-center justify-between gap-2">
                    <div>
                        <h2 class="text-lg font-semibold" data-i18n="instagramConsolePage.publishSectionTitle">发布到 Instagram</h2>
                        <p class="text-sm text-slate-500" data-i18n="instagramConsolePage.commentPreview">发布预览</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <label class="text-sm text-slate-700" for="image-url" data-i18n="instagramConsolePage.imageOverrideLabel">图片地址（可选，默认使用点评首图）</label>
                        <input id="image-url" type="text" class="w-72 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-200" placeholder="https://" />
                        <button id="publish-button" class="rounded-full bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-indigo-500 transition" data-i18n="instagramConsolePage.publishButton">发布</button>
                    </div>
                </div>
                <div id="publish-status" class="mt-2 text-sm text-slate-600"></div>
                <pre id="preview" class="mt-3 whitespace-pre-wrap rounded-lg border border-slate-200 bg-slate-50 p-3 text-sm text-slate-800"></pre>
            </section>

            <section class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
                <h2 class="text-lg font-semibold" data-i18n="instagramConsolePage.webhookTitle">Instagram Webhook 配置</h2>
                <ul id="webhook-steps" class="mt-3 list-disc space-y-1 pl-5 text-sm text-slate-700"></ul>
            </section>
        </div>
    </main>

    <script>
        const AUTHING_APP_ID = '68f5b0b6875017c02b3bfdb3';
        const AUTHING_HOST = 'https://xfvu647mcdbk-demo.authing.cn';

        let currentAuthUser = null;
        let currentTemplate = '';
        let currentRating = null;
        let currentComments = [];
        let selectedCommentId = null;

        function login() {
            const redirectUri = window.location.origin;
            const authorizeUrl = new URL('/oidc/auth', AUTHING_HOST);
            authorizeUrl.search = new URLSearchParams({
                client_id: AUTHING_APP_ID,
                redirect_uri: redirectUri,
                response_type: 'code',
                scope: 'openid profile email phone',
                state: Math.random().toString(36).slice(2)
            }).toString();
            window.location.href = authorizeUrl.toString();
        }

        function logout() {
            const logoutUrl = new URL('/oidc/session/end', AUTHING_HOST);
            logoutUrl.search = new URLSearchParams({
                post_logout_redirect_uri: window.location.origin
            }).toString();
            sessionStorage.removeItem('userInfo');
            sessionStorage.removeItem('accessToken');
            window.location.href = logoutUrl.toString();
        }

        function renderLoginStatus(user) {
            const container = document.getElementById('login-status-container');
            const canTranslate = typeof i18next !== 'undefined' && i18next.isInitialized;
            if (!container) return;
            const loginText = canTranslate ? i18next.t('nav.login') : 'Login';
            const logoutText = canTranslate ? i18next.t('nav.logout') : 'Logout';
            if (user) {
                const name = user.nickname || user.name || user.preferred_username || user.email || '';
                container.innerHTML = `<span class="hidden text-xs font-medium text-gray-700 sm:inline">${name}</span><button onclick="logout()" class="rounded-full bg-red-500 px-3 py-1 text-xs font-medium text-white hover:bg-red-600">${logoutText}</button>`;
            } else {
                container.innerHTML = `<button onclick="login()" class="rounded-full bg-green-500 px-3 py-1 text-xs font-medium text-white hover:bg-green-600">${loginText}</button>`;
            }
        }

        function renderLanguageSwitcher() {
            const container = document.getElementById('language-flags');
            if (!container || typeof i18next === 'undefined' || !i18next.isInitialized) return;
            container.innerHTML = '';
            const languages = ['zh', 'en', 'es'];
            const currentLang = i18next.language ? i18next.language.split('-')[0] : 'zh';
            languages.forEach(lang => {
                const button = document.createElement('button');
                button.textContent = lang.toUpperCase();
                button.className = `lang-button ${lang === currentLang ? 'active' : ''}`;
                button.dataset.lang = lang;
                button.onclick = async (event) => {
                    const newLang = event.currentTarget.dataset.lang;
                    if (newLang === currentLang) return;
                    await i18next.changeLanguage(newLang);
                    updateContent();
                    renderLanguageSwitcher();
                    renderLoginStatus(currentAuthUser);
                    renderAdminLinks();
                };
                container.appendChild(button);
            });
        }

        function renderAdminLinks() {
            const configLink = document.getElementById('config-admin-link');
            const instagramLink = document.getElementById('instagram-admin-link');
            const canTranslate = typeof i18next !== 'undefined' && i18next.isInitialized;
            if (configLink) configLink.classList.add('hidden');
            if (instagramLink) instagramLink.classList.add('hidden');
            if (!currentAuthUser || !canTranslate) return;
            if (currentAuthUser.db_role === 'admin' || currentAuthUser.db_role === 'super_admin') {
                configLink?.classList.remove('hidden');
                configLink.textContent = i18next.t('nav.configAdmin');
            }
            if (currentAuthUser.db_role === 'super_admin') {
                instagramLink?.classList.remove('hidden');
                instagramLink.textContent = i18next.t('nav.instagramConsole');
            }
        }

        async function handleOidcCallback(code) {
            try {
                const redirectUri = window.location.origin;
                const apiUrl = new URL('/api/authing/callback', window.location.origin);
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code, redirect_uri: redirectUri })
                });
                if (!response.ok) {
                    throw new Error('Login failed');
                }
                const fullUserProfile = await response.json();
                sessionStorage.setItem('userInfo', JSON.stringify(fullUserProfile));
                sessionStorage.setItem('accessToken', fullUserProfile.accessToken);
                return fullUserProfile;
            } catch (error) {
                console.error('OIDC callback failed', error);
                const fallback = `Login failed: ${error.message}`;
                const message = typeof i18next !== 'undefined' && i18next.isInitialized
                    ? i18next.t('errors.loginFailed', { message: error.message })
                    : fallback;
                alert(message);
                sessionStorage.removeItem('userInfo');
                sessionStorage.removeItem('accessToken');
                return null;
            } finally {
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        async function validateSessionAndGetUser() {
            const token = sessionStorage.getItem('accessToken');
            if (!token) return null;
            try {
                const response = await fetch('/api/me', { headers: { 'Authorization': `Bearer ${token}` } });
                if (!response.ok) throw new Error('Session invalid');
                const fullUserProfile = await response.json();
                sessionStorage.setItem('userInfo', JSON.stringify(fullUserProfile));
                return fullUserProfile;
            } catch (error) {
                console.warn('Session validation failed', error);
                sessionStorage.removeItem('userInfo');
                sessionStorage.removeItem('accessToken');
                return null;
            }
        }

        function ensureSuperAdminUI() {
            const guard = document.getElementById('auth-guard');
            const consoleWrapper = document.getElementById('console-wrapper');
            const allowed = currentAuthUser && currentAuthUser.db_role === 'super_admin';
            guard.classList.toggle('hidden', !!allowed);
            consoleWrapper.classList.toggle('hidden', !allowed);
            return allowed;
        }

        function setStatus(elementId, message, tone = 'muted') {
            const el = document.getElementById(elementId);
            if (!el) return;
            const color = tone === 'error' ? 'text-red-600' : tone === 'success' ? 'text-emerald-600' : 'text-slate-500';
            el.className = `mt-2 text-xs ${color}`;
            el.textContent = message || '';
        }

        function updatePreview() {
            const preview = document.getElementById('preview');
            const status = document.getElementById('publish-status');
            if (!currentRating || !selectedCommentId) {
                preview.textContent = i18next.t('instagramConsolePage.noSelection');
                status.textContent = '';
                return;
            }
            const comment = currentComments.find(c => c.id === selectedCommentId);
            if (!comment) return;
            const imageUrl = document.getElementById('image-url').value.trim() || (Array.isArray(currentRating.imageUrl) ? currentRating.imageUrl[0] : '');
            const placeholders = buildPlaceholderData(currentRating, comment, imageUrl);
            preview.textContent = applyTemplate(currentTemplate, placeholders);
        }

        function buildPlaceholderData(rating, comment, imageUrl) {
            const resultsUrl = new URL(`/results.html?id=${rating.id}`, window.location.origin).toString();
            return {
                title: rating.title || '',
                cigarName: rating.cigarInfo?.name || rating.cigarName || '',
                cigarOrigin: rating.cigarInfo?.origin || rating.cigarOrigin || '',
                cigarSize: rating.cigarInfo?.size || rating.cigarSize || '',
                score: rating.normalizedScore ?? rating.fullData?.normalizedScore ?? '',
                grade: rating.finalGrade?.grade || rating.finalGrade_grade || rating.finalGrade_name_cn || '',
                comment: comment.content || '',
                commentAuthor: comment.userNickname || '',
                resultsUrl,
                imageUrl: imageUrl || ''
            };
        }

        function applyTemplate(template, data) {
            if (!template) return '';
            return template.replace(/{{(\w+)}}/g, (_, key) => {
                const value = data[key];
                return value === undefined || value === null ? '' : String(value);
            });
        }

        async function loadTemplate() {
            const token = sessionStorage.getItem('accessToken');
            if (!token) return;
            try {
                const response = await fetch('/api/instagram', { headers: { 'Authorization': `Bearer ${token}` } });
                if (!response.ok) throw new Error(await response.text());
                const data = await response.json();
                currentTemplate = data.template || '';
                document.getElementById('template-editor').value = currentTemplate;
                setStatus('template-status', '');
                updatePreview();
            } catch (error) {
                console.error('Failed to load template', error);
                setStatus('template-status', i18next.t('instagramConsolePage.templateLoadFailed', { msg: error.message }), 'error');
            }
        }

        async function saveTemplate() {
            const token = sessionStorage.getItem('accessToken');
            const templateText = document.getElementById('template-editor').value;
            if (!token) return alert(i18next.t('common.loginRequired'));
            try {
                const response = await fetch('/api/instagram', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ template: templateText })
                });
                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error || response.statusText);
                }
                currentTemplate = templateText;
                setStatus('template-status', i18next.t('instagramConsolePage.templateSaved'), 'success');
                updatePreview();
            } catch (error) {
                console.error('Save template failed', error);
                setStatus('template-status', i18next.t('instagramConsolePage.templateSaveFailed', { msg: error.message }), 'error');
            }
        }

        function renderRatingSummary(rating) {
            const container = document.getElementById('rating-summary');
            if (!rating) {
                container.textContent = '';
                return;
            }
            const imageCount = Array.isArray(rating.imageUrl) ? rating.imageUrl.length : 0;
            container.innerHTML = `
                <div><span class="font-semibold">${i18next.t('common.name')}:</span> ${rating.cigarInfo?.name || rating.cigarName || i18next.t('common.noData')}</div>
                <div><span class="font-semibold">${i18next.t('ratePage.cigarOrigin')}:</span> ${rating.cigarInfo?.origin || rating.cigarOrigin || i18next.t('common.noData')}</div>
                <div><span class="font-semibold">${i18next.t('ratePage.cigarSize')}:</span> ${rating.cigarInfo?.size || rating.cigarSize || i18next.t('common.noData')}</div>
                <div><span class="font-semibold">${i18next.t('common.score')}:</span> ${rating.normalizedScore ?? rating.fullData?.normalizedScore ?? i18next.t('common.noData')}</div>
                <div><span class="font-semibold">${i18next.t('instagramConsolePage.ratingIdLabel')}:</span> ${rating.id}</div>
                <div><span class="font-semibold">${i18next.t('common.image')}:</span> ${imageCount}</div>
            `;
        }

        function renderComments(comments) {
            const list = document.getElementById('comments-list');
            const empty = document.getElementById('comments-empty');
            list.innerHTML = '';
            if (!comments || !comments.length) {
                empty.classList.remove('hidden');
                return;
            }
            empty.classList.add('hidden');
            comments.forEach(comment => {
                const wrapper = document.createElement('label');
                wrapper.className = 'flex cursor-pointer items-start gap-2 rounded-lg border border-slate-200 bg-slate-50 p-2 hover:border-indigo-200';
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'comment-select';
                input.value = comment.id;
                input.checked = comment.id === selectedCommentId;
                input.onchange = () => {
                    selectedCommentId = comment.id;
                    updatePreview();
                };
                const body = document.createElement('div');
                body.innerHTML = `<div class="text-sm font-semibold">${comment.userNickname || i18next.t('common.anonymous')}</div><div class="text-sm text-slate-700 whitespace-pre-wrap">${comment.content}</div>`;
                wrapper.appendChild(input);
                wrapper.appendChild(body);
                list.appendChild(wrapper);
            });
        }

        async function loadRatingAndComments() {
            const ratingId = document.getElementById('rating-id').value.trim();
            const token = sessionStorage.getItem('accessToken');
            if (!ratingId) return;
            setStatus('publish-status', i18next.t('common.loading'), 'muted');
            try {
                const ratingRes = await fetch(`/api/ratings?id=${encodeURIComponent(ratingId)}`);
                if (!ratingRes.ok) throw new Error(await ratingRes.text());
                const rating = await ratingRes.json();
                if (rating.imageUrl && typeof rating.imageUrl === 'string') {
                    try { rating.imageUrl = JSON.parse(rating.imageUrl); } catch (_) { rating.imageUrl = []; }
                }
                currentRating = rating;
                renderRatingSummary(rating);

                const commentsRes = await fetch(`/api/comments?ratingId=${encodeURIComponent(ratingId)}`, {
                    headers: token ? { 'Authorization': `Bearer ${token}` } : {}
                });
                if (!commentsRes.ok) throw new Error(await commentsRes.text());
                const commentsData = await commentsRes.json();
                currentComments = commentsData.comments || [];
                selectedCommentId = currentComments[0]?.id || null;
                renderComments(currentComments);
                updatePreview();
                setStatus('publish-status', '');
            } catch (error) {
                console.error('Failed to load rating/comments', error);
                setStatus('publish-status', i18next.t('instagramConsolePage.ratingLoadFailed', { msg: error.message }), 'error');
                currentRating = null;
                currentComments = [];
                renderRatingSummary(null);
                renderComments([]);
                updatePreview();
            }
        }

        async function publishToInstagram() {
            const token = sessionStorage.getItem('accessToken');
            if (!token) return alert(i18next.t('common.loginRequired'));
            if (!currentRating || !selectedCommentId) return alert(i18next.t('instagramConsolePage.noSelection'));
            const imageUrl = document.getElementById('image-url').value.trim();
            const button = document.getElementById('publish-button');
            button.disabled = true;
            const originalText = button.textContent;
            button.textContent = i18next.t('instagramConsolePage.publishing');
            setStatus('publish-status', i18next.t('instagramConsolePage.publishing'), 'muted');
            try {
                const response = await fetch('/api/instagram', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ ratingId: currentRating.id, commentId: selectedCommentId, imageUrl })
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || response.statusText);
                }
                setStatus('publish-status', i18next.t('instagramConsolePage.publishSuccess'), 'success');
            } catch (error) {
                console.error('Publish failed', error);
                setStatus('publish-status', i18next.t('instagramConsolePage.publishFailed', { msg: error.message }), 'error');
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        }

        function renderWebhookSteps() {
            const steps = i18next.t('instagramConsolePage.webhookSteps', { returnObjects: true });
            const list = document.getElementById('webhook-steps');
            list.innerHTML = '';
            if (Array.isArray(steps)) {
                steps.forEach(step => {
                    const li = document.createElement('li');
                    li.textContent = step;
                    list.appendChild(li);
                });
            }
        }

        function updateContent() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const rawKey = el.getAttribute('data-i18n');
                if (!rawKey) return;
                if (rawKey.startsWith('[placeholder]')) {
                    const key = rawKey.replace('[placeholder]', '');
                    const value = i18next.t(key);
                    if (value) el.setAttribute('placeholder', value);
                } else {
                    const value = i18next.t(rawKey);
                    if (value) el.textContent = value;
                }
            });
            renderWebhookSteps();
            renderRatingSummary(currentRating);
            renderComments(currentComments);
            updatePreview();
        }

        async function initPage() {
            await new Promise(resolve => {
                if (document.readyState === 'complete' || document.readyState === 'interactive') return resolve();
                document.addEventListener('DOMContentLoaded', resolve);
            });

            const normalizeLanguage = (lng) => {
                if (!lng) return 'zh';
                const base = Array.isArray(lng) ? lng[0] : lng;
                return base.split('-')[0].split('@')[0] || 'zh';
            };

            await i18next.use(i18nextHttpBackend).use(i18nextBrowserLanguageDetector).init({
                fallbackLng: 'zh',
                load: 'languageOnly',
                supportedLngs: ['zh', 'en', 'es'],
                backend: {
                    loadPath: (lng) => `/locales/${normalizeLanguage(lng)}.json`
                },
                detection: {
                    order: ['querystring', 'localStorage', 'navigator'],
                    convertDetectedLanguage: normalizeLanguage
                }
            });

            const normalizedLng = normalizeLanguage(i18next.language);
            if (normalizedLng !== i18next.language) {
                await i18next.changeLanguage(normalizedLng);
            }
            updateContent();

            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('code')) {
                currentAuthUser = await handleOidcCallback(urlParams.get('code'));
            } else {
                const stored = sessionStorage.getItem('userInfo');
                currentAuthUser = stored ? JSON.parse(stored) : await validateSessionAndGetUser();
            }

            renderLanguageSwitcher();
            renderLoginStatus(currentAuthUser);
            renderAdminLinks();
            if (!ensureSuperAdminUI()) return;

            await loadTemplate();
            renderWebhookSteps();
        }

        document.addEventListener('navbar:loaded', () => {
            if (i18next.isInitialized) {
                renderLanguageSwitcher();
                renderAdminLinks();
            }
            renderLoginStatus(currentAuthUser);
        });

        document.addEventListener('DOMContentLoaded', () => {
            initPage();
            document.getElementById('save-template').addEventListener('click', saveTemplate);
            document.getElementById('load-rating').addEventListener('click', loadRatingAndComments);
            document.getElementById('publish-button').addEventListener('click', publishToInstagram);
            document.getElementById('template-editor').addEventListener('input', (event) => {
                currentTemplate = event.target.value;
                updatePreview();
            });
            document.getElementById('image-url').addEventListener('input', updatePreview);
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雪茄品鉴 - 评分报告</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans SC', 'system-ui', 'sans-serif'],
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        highlight: {
                            '0%, 100%': { transform: 'scale(1)', boxShadow: '0 0 0 rgba(66, 153, 225, 0)' },
                            '50%': { transform: 'scale(1.02)', boxShadow: '0 0 15px rgba(66, 153, 225, 0.4)' },
                        }
                    },
                    animation: {
                        fadeInUp: 'fadeInUp 0.8s ease-out forwards',
                        highlight: 'highlight 1.5s ease-in-out infinite',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 font-sans antialiased text-gray-800">

    <div class="max-w-4xl mx-auto p-4 md:p-8">
        
        <div id="error-container" class="hidden bg-red-100 p-6 rounded-lg shadow-lg text-center text-red-700 font-medium">
            <!-- JS will be injected here -->
        </div>

        <div id="main-content" class="opacity-0" style="animation-delay: 0.2s;">
            <header class="mb-6 text-center">
                <h1 class="text-4xl font-extrabold text-gray-800 mb-2">评分报告</h1>
            </header>
            
            <!-- (*** 新增：雪茄信息展示区域 ***) -->
            <section id="cigar-info-container" class="mb-6">
                <!-- JS will inject cigar info here -->
            </section>

            <section id="results-card-container" class="mb-8">
                <!-- JS will be injected here -->
            </section>

            <div class="space-y-4">
                <details class="group bg-white rounded-xl shadow-lg p-6 transition-all duration-300">
                    <summary class="flex justify-between items-center cursor-pointer font-bold text-lg text-gray-800">
                        分数详情
                        <svg class="w-5 h-5 transform group-open:rotate-180 transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </summary>
                    <div id="score-details-container" class="mt-4 text-center">
                        <!-- JS will be injected here -->
                    </div>
                </details>

                <details class="group bg-white rounded-xl shadow-lg p-6 transition-all duration-300">
                    <summary class="flex justify-between items-center cursor-pointer font-bold text-lg text-gray-800">
                        评分详情汇总
                        <svg class="w-5 h-5 transform group-open:rotate-180 transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </summary>
                    <div id="summary-container" class="mt-4">
                         <!-- JS will be injected here -->
                    </div>
                </details>

                <details class="group bg-white rounded-xl shadow-lg p-6 transition-all duration-300 open">
                    <summary class="flex justify-between items-center cursor-pointer font-bold text-lg text-gray-800">
                        PISTACHO 评级体系
                        <svg class="w-5 h-5 transform group-open:rotate-180 transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </summary>
                    <div id="full-scale-container" class="mt-4">
                         <!-- JS will be injected here -->
                    </div>
                </details>
            </div>


            <footer class="mt-8 text-center">
                <a href="index.html" 
                   class="py-3 px-6 bg-indigo-600 text-white font-bold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150">
                    &larr; 返回重新评分
                </a>
            </footer>
        </div>
    </div>

    <script>
        const GRADING_SCALE = [
          { "grade": "P", "name_en": "Pinnacle", "name_cn": "顶峰 / 登峰造极", "min_score": 95, "color": "gold" },
          { "grade": "I", "name_en": "Impeccable", "name_cn": "无暇 / 完美无瑕", "min_score": 90, "color": "indigo" },
          { "grade": "S", "name_en": "Superior", "name_cn": "卓越 / 出众", "min_score": 85, "color": "purple" },
          { "grade": "T", "name_en": "Terrific", "name_cn": "极好 / 绝佳", "min_score": 80, "color": "blue" },
          { "grade": "A", "name_en": "Appreciable", "name_cn": "可圈可点 / 值得欣赏", "min_score": 70, "color": "green" },
          { "grade": "C", "name_en": "Commonplace", "name_cn": "平庸 / 普通", "min_score": 60, "color": "gray" },
          { "grade": "H", "name_en": "Hesitant", "name_cn": "犹豫 / 瑕瑜互见", "min_score": 40, "color": "orange" },
          { "grade": "O", "name_en": "Ordinary", "name_cn": "乏善可陈 / 平淡", "min_score": 0, "color": "red" }
        ];

        window.onload = function() {
            const mainContent = document.getElementById('main-content');
            const cigarInfoContainer = document.getElementById('cigar-info-container');
            const resultsCardContainer = document.getElementById('results-card-container');
            const scoreDetailsContainer = document.getElementById('score-details-container');
            const summaryContainer = document.getElementById('summary-container');
            const errorContainer = document.getElementById('error-container');
            const fullScaleContainer = document.getElementById('full-scale-container');
            
            mainContent.classList.add('animate-fadeInUp');

            const storedData = sessionStorage.getItem('cigarRatingResults');
            
            if (!storedData) {
                errorContainer.classList.remove('hidden');
                errorContainer.innerHTML = `<p class="font-bold">没有找到评分数据！</p><p>请从主页完成一次评分。</p><a href="index.html" class="inline-block mt-4 text-indigo-600 underline">返回</a>`;
                return;
            }
            
            try {
                // (*** 新增：从数据中提取 cigarInfo ***)
                const { config, ratings, calculatedScore, cigarInfo } = JSON.parse(storedData);
                const maxScore = config.totalWeightMax || 100;
                const normalizedScore = (calculatedScore / maxScore) * 100;
                
                let finalGrade = GRADING_SCALE[GRADING_SCALE.length - 1];
                for (const grade of GRADING_SCALE) {
                    if (normalizedScore >= grade.min_score) {
                        finalGrade = grade;
                        break;
                    }
                }
                
                // (*** 新增：渲染雪茄信息 ***)
                if (cigarInfo) {
                    renderCigarInfo(cigarInfoContainer, cigarInfo);
                }

                renderResultsCard(resultsCardContainer, normalizedScore, finalGrade);
                scoreDetailsContainer.innerHTML = `<p class="text-lg text-gray-600">原始得分: <span class="font-bold text-gray-800">${calculatedScore.toFixed(2)}</span> / ${maxScore.toFixed(2)}</p>`;
                renderSummary(summaryContainer, config, ratings);
                renderFullScale(fullScaleContainer, finalGrade);
                
            } catch (e) {
                 errorContainer.classList.remove('hidden');
                 errorContainer.innerHTML = `<p class="font-bold">解析数据出错！</p><p>${e.message}</p><a href="index.html" class="inline-block mt-4 text-indigo-600 underline">返回</a>`;
                 console.error("Results page error:", e);
            }
        }
        
        // --- 渲染函数 ---

        // (*** 新增：渲染雪茄信息的函数 ***)
        function renderCigarInfo(container, info) {
            container.innerHTML = `
                <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                    <h2 class="text-3xl font-bold text-gray-800">${info.name}</h2>
                    <div class="mt-2 flex justify-center items-center space-x-6 text-gray-500">
                        <span><strong class="font-semibold text-gray-600">尺寸:</strong> ${info.size}</span>
                        <span class="border-l border-gray-300 h-4"></span>
                        <span><strong class="font-semibold text-gray-600">产地:</strong> ${info.origin}</span>
                    </div>
                </div>
            `;
        }

        function renderResultsCard(container, score, grade) {
            const { bgGradient, textColor, shadowColor, ringColor } = getGradeStyles(grade.color);
            container.innerHTML = `
                <div class="relative rounded-2xl p-8 text-white overflow-hidden shadow-2xl ${bgGradient} ${shadowColor}">
                    <div class="relative z-10 flex justify-between items-center">
                        <div>
                            <p class="font-medium opacity-80">${grade.name_en}</p>
                            <h2 class="text-4xl font-extrabold tracking-tight">${grade.name_cn}</h2>
                            <p class="mt-4 text-7xl font-black">${score.toFixed(2)}</p>
                        </div>
                        <div class="flex-shrink-0 w-32 h-32 rounded-full border-4 border-white border-opacity-50 flex flex-col items-center justify-center bg-white bg-opacity-10 backdrop-blur-sm">
                            <span class="text-6xl font-black">${grade.grade}</span>
                            <span class="font-semibold tracking-widest uppercase">${grade.name_en}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSummary(container, config, ratings) { /* ... (same as before) ... */ }
        function renderFullScale(container, finalGrade) { /* ... (same as before) ... */ }
        function getScoreRange(grade) { /* ... (same as before) ... */ }
        function getGradeStyles(color) { /* ... (same as before) ... */ }
    </script>
</body>
</html>


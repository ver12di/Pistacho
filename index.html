<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›ªèŒ„å“é‰´è¯„åˆ†ç³»ç»Ÿ</title>
    <!-- å¼•å…¥ Tailwind CSS åº“ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è®¾ç½®è‡ªå®šä¹‰ Tailwind é…ç½®ï¼Œä½¿ç”¨ Inter å­—ä½“ï¼Œå¹¶å¯ç”¨ä¸€äº›å¸¸ç”¨åŠŸèƒ½ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'Avenir', 'Helvetica', 'Arial', 'sans-serif'],
                    },
                    colors: {
                        'cigar-dark': '#4A2B1D',
                        'cigar-light': '#D6C8B5',
                        'accent': '#A0522D',
                        'accent-dark': '#8B4513'
                    }
                },
            }
        }
    </script>
    <style>
        /* ç¡®ä¿é¡µé¢å…¨é«˜ä¸”èƒŒæ™¯è‰²å¹³ç¨³ */
        body {
            background-color: #f7f7f7;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        .overflow-y-auto::-webkit-scrollbar {
            width: 8px;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb {
            background-color: #A0522D;
            border-radius: 4px;
        }
        .overflow-y-auto::-webkit-scrollbar-track {
            background-color: #D6C8B5;
        }
    </style>
</head>
<body class="font-sans">

    <!-- å¯¼èˆªæ  -->
    <header class="bg-cigar-dark text-white shadow-lg sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo/Title -->
                <div class="flex-shrink-0 cursor-pointer" onclick="switchView('landing')">
                    <span class="text-xl font-bold tracking-wider">CigarScore <span class="text-accent">PRO</span></span>
                </div>
                <!-- èœå• - æ¡Œé¢ç«¯ -->
                <nav class="hidden md:flex space-x-8">
                    <a href="#" class="text-cigar-light hover:text-white transition duration-300 rounded-lg px-3 py-2" onclick="switchView('landing')">é¦–é¡µ</a>
                    <a href="#" class="text-cigar-light hover:text-white transition duration-300 rounded-lg px-3 py-2">è¯„åˆ†æ ‡å‡†</a>
                    <a href="#" class="text-cigar-light hover:text-white transition duration-300 rounded-lg px-3 py-2">å†å²è®°å½•</a>
                    <a href="#" id="start-rating-btn-desktop" class="bg-accent text-white rounded-lg px-4 py-2 font-medium hover:bg-opacity-90 transition duration-300 shadow-md">å¼€å§‹è¯„åˆ†</a>
                </nav>
                <!-- èœå• - ç§»åŠ¨ç«¯æŒ‰é’® -->
                <button id="menu-button" class="md:hidden p-2 rounded-lg text-cigar-light hover:bg-cigar-light hover:text-cigar-dark transition duration-300">
                    <!-- Hamburger Icon (Menu) -->
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>

        <!-- ç§»åŠ¨ç«¯èœå•å†…å®¹ (åˆå§‹éšè—) -->
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-white hover:bg-accent" onclick="switchView('landing')">é¦–é¡µ</a>
                <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-white hover:bg-accent">è¯„åˆ†æ ‡å‡†</a>
                <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-white hover:bg-accent">å†å²è®°å½•</a>
                <a href="#" id="start-rating-btn-mobile" class="block px-3 py-2 rounded-md text-base font-medium bg-accent text-white">å¼€å§‹è¯„åˆ†</a>
            </div>
        </div>
    </header>

    <!-- ä¸»åº”ç”¨å®¹å™¨ -->
    <div class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <!-- 1. é¦–é¡µ (Landing Page) è§†å›¾ -->
        <section id="landing-page-section">
            <div class="bg-white p-8 rounded-xl shadow-2xl">
                <!-- è‹±é›„åŒº/ä¸»è¦ä»‹ç» -->
                <div class="text-center mb-12">
                    <h1 class="text-4xl sm:text-5xl font-extrabold text-cigar-dark mb-4 leading-tight">
                        <span class="text-accent">P.I.S.T.A.C.H.O.</span> é›ªèŒ„å“é‰´ç³»ç»Ÿ
                    </h1>
                    <p id="system-subtitle" class="text-xl text-gray-600 max-w-3xl mx-auto mb-6">
                        å°†ä¸»è§‚å°è±¡è½¬åŒ–ä¸ºå®¢è§‚æ•°æ®ï¼Œä¸“ä¸šã€ç³»ç»Ÿåœ°è®°å½•æ¯ä¸€æ”¯é›ªèŒ„çš„ç‹¬ç‰¹ä½“éªŒã€‚
                    </p>
                    <div class="space-x-4">
                        <a href="#" class="bg-accent text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-opacity-80 transition duration-300 transform hover:scale-105">
                            æŸ¥çœ‹è¯„åˆ†ç­‰çº§
                        </a>
                        <a href="#" class="text-cigar-dark border border-cigar-dark font-semibold py-3 px-8 rounded-full hover:bg-cigar-dark hover:text-white transition duration-300 transform hover:scale-105">
                            äº†è§£ä½“ç³»æƒé‡
                        </a>
                    </div>
                </div>

                <!-- ç‰¹ç‚¹æ¦‚è§ˆ (åŸºäº CSV æ–‡ä»¶å†…å®¹) -->
                <div class="grid md:grid-cols-3 gap-8 text-cigar-dark mb-12">
                    <!-- ç‰¹ç‚¹ 1: å·å·¥ä¸å¤–è§‚ -->
                    <div class="bg-cigar-light/50 p-6 rounded-lg shadow-md hover:shadow-xl transition duration-500">
                        <div class="text-2xl font-bold mb-2 flex items-center">
                            <span class="text-accent mr-2">ğŸª¶</span> å¤–è§‚ä¸å·å·¥
                        </div>
                        <p class="text-gray-700">æ¶µç›–èŒ„æ ‡é«˜çº§æ„Ÿã€èŒ„è¡£çŠ¶æ€ï¼ˆè–„/åš/æ²¹æ¶¦/å¹²/èŒç»†ï¼‰å’Œå·å·¥ç»†èŠ‚ï¼ˆä¸åˆæ ¼åˆ°å®Œç¾ï¼‰ï¼ŒåŒºåˆ†**ç†Ÿç»ƒå·¥äºº**ä¸**ç²¾é›•ç»†ç¢**ã€‚</p>
                    </div>
                    
                    <!-- ç‰¹ç‚¹ 2: ç‡ƒçƒ§ä¸å¸é˜» -->
                    <div class="bg-cigar-light/50 p-6 rounded-lg shadow-md hover:shadow-xl transition duration-500">
                        <div class="text-2xl font-bold mb-2 flex items-center">
                            <span class="text-accent mr-2">ğŸ”¥</span> ç‡ƒçƒ§ä¸æ°”é“
                        </div>
                        <p class="text-gray-700">ç²¾ç¡®é‡åŒ–å¸é˜»ï¼ˆ**å¤©é€‰ä¹‹å¸** vs **ç‰©ç†ç»ç¼˜**ï¼‰ï¼Œè®°å½•ç‡ƒçƒ§çº¿å‡åŒ€åº¦ï¼ˆ**æ¿€å…‰åˆ‡å‰²**ï¼‰å’ŒçƒŸç°å½¢æ€ï¼ˆ**åŸƒè²å°”é“å¡”**ï¼‰ã€‚</p>
                    </div>

                    <!-- ç‰¹ç‚¹ 3: é¦™æ°”ä¸å˜åŒ– -->
                    <div class="bg-cigar-light/50 p-6 rounded-lg shadow-md hover:shadow-xl transition duration-500">
                        <div class="text-2xl font-bold mb-2 flex items-center">
                            <span class="text-accent mr-2">ğŸ‘ƒ</span> å¤æ‚é¦™æ°”è°±
                        </div>
                        <p class="text-gray-700">è¿½è¸ªç¬¬äºŒ/å¤šé‡é¦™æ°”çš„é«˜çº§åº¦å’ŒæŒç»­æ€§ï¼Œæ•æ‰ç”œå‘³ã€èŠ±é¦™ã€å¤å·´å‘³ç­‰å…³é”®è¯ï¼Œè®°å½•ä¸‰æ®µå˜åŒ–æ˜¯å¦æ˜æ˜¾ã€‚</p>
                    </div>
                </div>
            </div>

            <!-- è¯„åˆ†ç­‰çº§å‚è€ƒè¡¨ (P.I.S.T.A.C.H.O.) -->
            <div class="mt-12">
                <h2 class="text-3xl font-bold text-cigar-dark mb-6 text-center">P.I.S.T.A.C.H.O. ç­‰çº§é€ŸæŸ¥</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-xl shadow-lg border border-gray-200">
                        <thead class="bg-cigar-dark text-white">
                            <tr>
                                <th class="py-3 px-4 text-left rounded-tl-lg">ç­‰çº§</th>
                                <th class="py-3 px-4 text-left">å­—æ¯</th>
                                <th class="py-3 px-4 text-left">è‹±æ–‡æè¿°è¯</th>
                                <th class="py-3 px-4 text-left rounded-tr-lg">ä¸­æ–‡é‡Šä¹‰</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b hover:bg-yellow-50/50 transition duration-150">
                                <td class="py-3 px-4 font-bold text-accent">æœ€é«˜</td>
                                <td class="py-3 px-4 text-lg font-mono">P</td>
                                <td class="py-3 px-4">Perfection</td>
                                <td class="py-3 px-4">å®Œç¾ / è‡»å“</td>
                            </tr>
                            <tr class="border-b hover:bg-yellow-50/50 transition duration-150">
                                <td class="py-3 px-4">é«˜</td>
                                <td class="py-3 px-4 text-lg font-mono">I</td>
                                <td class="py-3 px-4">Iconic</td>
                                <td class="py-3 px-4">æ ‡å¿—æ€§ / å…¸èŒƒ</td>
                            </tr>
                            <tr class="border-b hover:bg-yellow-50/50 transition duration-150">
                                <td class="py-3 px-4">é«˜</td>
                                <td class="py-3 px-4 text-lg font-mono">S</td>
                                <td class="py-3 px-4">Supreme</td>
                                <td class="py-3 px-4">è‡³é«˜ / å“è¶Š</td>
                            </tr>
                            <tr class="border-b hover:bg-yellow-50/50 transition duration-150">
                                <td class="py-3 px-4">ä¸­</td>
                                <td class="py-3 px-4 text-lg font-mono">T</td>
                                <td class="py-3 px-4">Treasured</td>
                                <td class="py-3 px-4">çè— / ççˆ±</td>
                            </tr>
                            <tr class="border-b hover:bg-yellow-50/50 transition duration-150 bg-gray-50">
                                <td class="py-3 px-4">ä¸­</td>
                                <td class="py-3 px-4 text-lg font-mono">A</td>
                                <td class="py-3 px-4">Acceptable</td>
                                <td class="py-3 px-4">å¯æ¥å— / åˆæ ¼</td>
                            </tr>
                            <tr class="border-b hover:bg-yellow-50/50 transition duration-150">
                                <td class="py-3 px-4">ä½</td>
                                <td class="py-3 px-4 text-lg font-mono">C</td>
                                <td class="py-3 px-4">Common</td>
                                <td class="py-3 px-4">æ™®é€š / ä¸€èˆ¬</td>
                            </tr>
                            <tr class="border-b hover:bg-yellow-50/50 transition duration-150">
                                <td class="py-3 px-4">ä½</td>
                                <td class="py-3 px-4 text-lg font-mono">H</td>
                                <td class="py-3 px-4">Hardship</td>
                                <td class="py-3 px-4">å›°éš¾ / ç¼ºé™·å¤š</td>
                            </tr>
                            <tr class="hover:bg-yellow-50/50 transition duration-150">
                                <td class="py-3 px-4 font-bold text-red-600">æœ€ä½</td>
                                <td class="py-3 px-4 text-lg font-mono">O</td>
                                <td class="py-3 px-4">Outright Failure</td>
                                <td class="py-3 px-4">å½»åº•å¤±è´¥ / ä¸åˆæ ¼</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- é…ç½®ç®¡ç†åŒºåŸŸ (ä¿ç•™) -->
            <div class="mt-12 bg-white p-6 rounded-xl shadow-2xl border border-cigar-dark/20">
                <button id="toggle-config-btn" class="w-full text-left p-4 bg-cigar-dark text-white font-bold rounded-lg hover:bg-accent transition duration-300 flex justify-between items-center">
                    <span>âš™ï¸ è¯„åˆ†é…ç½®ç®¡ç† (cigar_rating_config.json)</span>
                    <svg id="config-arrow" class="w-6 h-6 transform rotate-0 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>

                <div id="config-content" class="mt-4 hidden">
                    <p class="mb-3 text-sm text-gray-600">åœ¨æ­¤æ–‡æœ¬æ¡†ä¸­ç¼–è¾‘ JSON é…ç½®ï¼Œç„¶åç‚¹å‡»â€œåº”ç”¨é…ç½®â€ä»¥åœ¨å½“å‰ä¼šè¯ä¸­åŠ è½½æ–°çš„è¯„åˆ†æ ‡å‡†ã€æƒé‡å’Œå¾—åˆ†æ¯”ä¾‹ã€‚**è¯·ç¡®ä¿ JSON æ ¼å¼æ­£ç¡®ã€‚**</p>
                    <textarea id="json-config-textarea" class="w-full h-80 p-4 border border-gray-300 rounded-lg font-mono text-sm resize-none focus:ring-accent focus:border-accent" spellcheck="false"></textarea>
                    
                    <div class="flex flex-col sm:flex-row justify-between items-center mt-4 space-y-3 sm:space-y-0 sm:space-x-3">
                        <span id="config-status" class="text-sm text-gray-500 font-medium">çŠ¶æ€ï¼šå·²åŠ è½½é»˜è®¤é…ç½® (v1.0)</span>
                        <button id="apply-config-btn" class="w-full sm:w-auto bg-accent text-white font-semibold py-2 px-6 rounded-full shadow-md hover:bg-opacity-90 transition duration-300">
                            åº”ç”¨é…ç½®
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. è¯„åˆ†åº”ç”¨ (Rating Application) è§†å›¾ - åˆå§‹éšè— -->
        <section id="rating-app-section" class="hidden">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-cigar-dark mb-6 text-center">å¼€å§‹è¯„åˆ†ï¼šé›ªèŒ„å“é‰´è®°å½•</h1>
            
            <!-- é›ªèŒ„åŸºæœ¬ä¿¡æ¯è¾“å…¥ -->
            <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
                <h2 class="text-2xl font-bold text-accent mb-4 border-b pb-2">åŸºç¡€ä¿¡æ¯</h2>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label for="cigar-brand" class="block text-sm font-medium text-gray-700">å“ç‰Œ (Brand)</label>
                        <input type="text" id="cigar-brand" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-accent focus:border-accent" placeholder="ä¾‹å¦‚ï¼šCohiba">
                    </div>
                    <div>
                        <label for="cigar-model" class="block text-sm font-medium text-gray-700">å‹å· (Model)</label>
                        <input type="text" id="cigar-model" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-accent focus:border-accent" placeholder="ä¾‹å¦‚ï¼šRobusto">
                    </div>
                    <div class="md:col-span-2">
                        <label for="cigar-notes" class="block text-sm font-medium text-gray-700">å“é‰´ç¬”è®° (Notes)</label>
                        <textarea id="cigar-notes" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border focus:ring-accent focus:border-accent" placeholder="è®°å½•å“å¸å‰å’Œå“å¸åçš„ä¸»è§‚å°è±¡..."></textarea>
                    </div>
                </div>
            </div>

            <!-- åŠ¨æ€è¯„åˆ†æ ‡å‡†å®¹å™¨ -->
            <form id="rating-form" class="space-y-6">
                <!-- è¯„åˆ†æ ‡å‡†å°†é€šè¿‡ JavaScript åŠ¨æ€æ’å…¥åˆ°è¿™é‡Œ -->
                <div class="text-center text-gray-500 p-8 bg-white rounded-xl shadow-lg">
                    <p>åŠ è½½ä¸­æˆ–ç­‰å¾…é…ç½®...</p>
                </div>
            </form>

            <!-- è¯„åˆ†ç»“æœå’Œè®¡ç®—æŒ‰é’® -->
            <div class="mt-8 pt-6 border-t border-gray-300 flex flex-col sm:flex-row justify-between items-center bg-white p-6 rounded-xl shadow-lg">
                <div class="text-xl font-bold text-cigar-dark mb-4 sm:mb-0">
                    æœ€ç»ˆå¾—åˆ†ï¼š<span id="final-score" class="text-accent text-3xl">0.0</span> / <span class="text-3xl">100.0</span>
                </div>
                <button id="calculate-score-btn" class="w-full sm:w-auto bg-cigar-dark text-white font-semibold py-3 px-8 rounded-full shadow-xl hover:bg-accent-dark transition duration-300 transform hover:scale-105">
                    è®¡ç®—æœ€ç»ˆè¯„åˆ†
                </button>
            </div>
        </section>
    </div>

    <!-- é¡µè„š -->
    <footer class="bg-cigar-dark mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-cigar-light text-sm">
            <p>&copy; 2025 CigarScore PRO. åŸºäº P.I.S.T.A.C.H.O. ä½“ç³»æ„å»ºã€‚</p>
            <div class="mt-2 space-x-4">
                <a href="#" class="hover:text-white transition duration-300">éšç§æ”¿ç­–</a>
                <span class="text-white/50">|</span>
                <a href="#" class="hover:text-white transition duration-300">è”ç³»æˆ‘ä»¬</a>
            </div>
        </div>
    </footer>

    <!-- JavaScript é€»è¾‘ -->
    <script>
        // 1. é»˜è®¤é…ç½®æ•°æ® (æ¥è‡ª cigar_rating_config.json)
        // è¿™æ˜¯ä¸€ä¸ªåŒ…å«è¯„åˆ†ä½“ç³»æ‰€æœ‰æƒé‡çš„é»˜è®¤é…ç½® JSON
        const DEFAULT_CONFIG_JSON = {
          "appTitle": "P.I.S.T.A.C.H.O. é›ªèŒ„å“é‰´é…ç½®",
          "version": "1.0",
          "totalWeightMax": 100,
          "lastUpdated": "2025-10-16",
          "ratingCriteria": [
            {
              "category": "å¤–è§‚ä¸å·å·¥ (Construction & Appearance)",
              "criteriaList": [
                {
                  "name": "èŒ„æ ‡é«˜çº§æ„Ÿ",
                  "weight": 5,
                  "options": [
                    {"description": "ç®€é™‹ (Dismal)", "scorePct": 0.10},
                    {"description": "ä¸­è§„ä¸­çŸ© (Standard)", "scorePct": 0.50},
                    {"description": "æ¼‚äº® (Elegant)", "scorePct": 0.70},
                    {"description": "å®Œç¾ (Perfect)", "scorePct": 1.00}
                  ]
                },
                {
                  "name": "èŒ„è¡£çŠ¶æ€",
                  "weight": 10,
                  "options": [
                    {"description": "ç®€é™‹/å¤šèŒ (Dismal/Veiny)", "scorePct": 0.10},
                    {"description": "æ­£å¸¸/ä¸­è§„ä¸­çŸ© (Normal)", "scorePct": 0.50},
                    {"description": "æ²¹æ¶¦/æ¼‚äº® (Oily/Beautiful)", "scorePct": 0.70},
                    {"description": "ä¸ç»¸è§¦æ„Ÿ/é¡¶çº§çš®å…· (Silky/Luxury)", "scorePct": 1.00}
                  ]
                },
                {
                  "name": "å·å·¥",
                  "weight": 15,
                  "options": [
                    {"description": "ä¸åˆæ ¼/è„±èƒ¶ (Unacceptable/Unraveling)", "scorePct": 0.10},
                    {"description": "æ­£å¸¸ (Normal)", "scorePct": 0.50},
                    {"description": "æ¼‚äº®/ç†Ÿç»ƒå·¥äºº (Beautiful/Skilled)", "scorePct": 0.70},
                    {"description": "å®Œç¾/ç²¾é›•ç»†ç¢ (Flawless/Artisan)", "scorePct": 1.00}
                  ]
                }
              ]
            },
            {
              "category": "ç‡ƒçƒ§ä¸æ°”é“ (Burn & Draw)",
              "criteriaList": [
                {
                  "name": "å¸é˜»",
                  "weight": 15,
                  "options": [
                    {"description": "å µå¡/ç‰©ç†ç»ç¼˜ (Blocked/Insulation)", "scorePct": 0.0},
                    {"description": "åæ¾ (Loose)", "scorePct": 0.50},
                    {"description": "åç´§ (Tight)", "scorePct": 0.50},
                    {"description": "å®Œç¾/å¤©é€‰ä¹‹å¸ (Perfect/Chosen Draw)", "scorePct": 1.00}
                  ]
                },
                {
                  "name": "ç‡ƒçƒ§å‡åŒ€æ€§",
                  "weight": 15,
                  "options": [
                    {"description": "æŒç»­ä¸å‡åŒ€ (Constantly Uneven)", "scorePct": 0.10},
                    {"description": "ç•¥ä¸å‡åŒ€éœ€çŸ«æ­£ (Slightly Uneven)", "scorePct": 0.70},
                    {"description": "å‡åŒ€/å®Œç¾å¹³è¡¡ (Even/Perfect Balance)", "scorePct": 1.00}
                  ]
                },
                {
                  "name": "çƒŸç°å½¢æ€",
                  "weight": 10,
                  "options": [
                    {"description": "è‡ªåŠ¨è„±è½ (Self-Dropping/Weak)", "scorePct": 0.30},
                    {"description": "éœ€è¦ä¸»åŠ¨å¼¹ (Needs Tapping)", "scorePct": 0.70},
                    {"description": "å®Œç¾/åŸƒè²å°”é“å¡” (Perfect/Eiffel Tower)", "scorePct": 1.00}
                  ]
                }
              ]
            },
            {
              "category": "é£å‘³ä¸ä½“éªŒ (Flavor & Experience)",
              "criteriaList": [
                {
                  "name": "å‰3å£æ„Ÿè§‰",
                  "weight": 5,
                  "options": [
                    {"description": "ä¼°è®¡ä¸æ€ä¹ˆæ ·/åŠé€€ (Doubtful/A warning)", "scorePct": 0.10},
                    {"description": "ä¸­è§„ä¸­çŸ© (Average)", "scorePct": 0.50},
                    {"description": "æœ‰æœŸå¾…/ç¨³æ­¥å‡æ¸© (Promising/Warming up)", "scorePct": 0.70},
                    {"description": "çœ¼å‰ä¸€äº®/å¼€åœºçˆ†æ£š (Immediate Wow/Blast off)", "scorePct": 1.00}
                  ]
                },
                {
                  "name": "ç¬¬äºŒé¦™æ°”å¼ºåº¦",
                  "weight": 15,
                  "options": [
                    {"description": "æ²¡æœ‰ (None)", "scorePct": 0.0},
                    {"description": "ä¸€ç‚¹ç‚¹é¦™ (Subtle)", "scorePct": 0.30},
                    {"description": "å¾ˆé¦™ (Fragrant)", "scorePct": 0.70},
                    {"description": "æé¦™ (Extremely Aromatic)", "scorePct": 1.00}
                  ]
                },
                {
                  "name": "ä¸‰æ®µå˜åŒ–",
                  "weight": 10,
                  "options": [
                    {"description": "å§‹ç»ˆå¦‚ä¸€ (Consistent)", "scorePct": 0.50},
                    {"description": "ä¼¼ä¹æœ‰å˜åŒ– (Seemingly changing)", "scorePct": 0.70},
                    {"description": "å˜åŒ–æ˜æ˜¾ (Clearly evolving)", "scorePct": 1.00}
                  ]
                }
              ]
            }
          ]
        };

        // 2. å½“å‰ä½¿ç”¨çš„é…ç½®ï¼ˆåˆå§‹ä¸ºé»˜è®¤é…ç½®ï¼‰
        let currentConfig = DEFAULT_CONFIG_JSON;

        // 3. é¡µé¢å…ƒç´ å¼•ç”¨
        const mobileMenu = document.getElementById('mobile-menu');
        const menuButton = document.getElementById('menu-button');
        const configTextarea = document.getElementById('json-config-textarea');
        const applyConfigBtn = document.getElementById('apply-config-btn');
        const toggleConfigBtn = document.getElementById('toggle-config-btn');
        const configContent = document.getElementById('config-content');
        const configStatus = document.getElementById('config-status');
        const systemSubtitle = document.getElementById('system-subtitle');
        const configArrow = document.getElementById('config-arrow');

        // è§†å›¾å…ƒç´ 
        const landingPageSection = document.getElementById('landing-page-section');
        const ratingAppSection = document.getElementById('rating-app-section');
        const ratingFormContainer = document.getElementById('rating-form');
        const startRatingBtnDesktop = document.getElementById('start-rating-btn-desktop');
        const startRatingBtnMobile = document.getElementById('start-rating-btn-mobile');
        const calculateScoreBtn = document.getElementById('calculate-score-btn');
        const finalScoreDisplay = document.getElementById('final-score');


        // 4. æ ¸å¿ƒå‡½æ•°ï¼šè§†å›¾åˆ‡æ¢
        function switchView(viewName) {
            if (viewName === 'landing') {
                landingPageSection.classList.remove('hidden');
                ratingAppSection.classList.add('hidden');
                // ç¡®ä¿ç§»åŠ¨èœå•å…³é—­
                mobileMenu.classList.add('hidden');
            } else if (viewName === 'rating') {
                landingPageSection.classList.add('hidden');
                ratingAppSection.classList.remove('hidden');
                // æ¸²æŸ“è¯„åˆ†è¡¨å•ï¼ˆç¡®ä¿åŠ è½½çš„æ˜¯æœ€æ–°é…ç½®ï¼‰
                renderRatingForm();
                // ç¡®ä¿ç§»åŠ¨èœå•å…³é—­
                mobileMenu.classList.add('hidden');
            }
            window.scrollTo({ top: 0, behavior: 'smooth' }); // åˆ‡æ¢åæ»šåŠ¨åˆ°é¡¶éƒ¨
        }


        // 5. æ ¸å¿ƒå‡½æ•°ï¼šæ¸²æŸ“è¯„åˆ†è¡¨å•
        function renderRatingForm() {
            // æ¯æ¬¡åˆ‡æ¢åˆ°è¯„åˆ†é¡µé¢æ—¶ï¼Œæ¸…ç©ºå¹¶é‡å»ºè¡¨å•
            ratingFormContainer.innerHTML = ''; 

            // 1. æ£€æŸ¥é…ç½®æ˜¯å¦æœ‰æ•ˆ
            if (!currentConfig.ratingCriteria || currentConfig.ratingCriteria.length === 0) {
                ratingFormContainer.innerHTML = `
                    <div class="text-center text-red-600 p-8 bg-white rounded-xl shadow-lg">
                        <p>ğŸ”´ é”™è¯¯ï¼šè¯„åˆ†é…ç½®æ— æ•ˆæˆ–ä¸ºç©ºï¼Œè¯·æ£€æŸ¥é…ç½®ç®¡ç†åŒºåŸŸã€‚</p>
                    </div>`;
                return;
            }

            // 2. éå†è¯„åˆ†åˆ†ç±» Category
            currentConfig.ratingCriteria.forEach((category, catIndex) => {
                const categoryId = `category-${catIndex}`;
                
                // è®¡ç®—è¯¥ç±»åˆ«æ€»æƒé‡
                const categoryTotalWeight = category.criteriaList.reduce((sum, c) => sum + c.weight, 0);

                let categoryHtml = `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <!-- Category Header (Accordion) -->
                        <button type="button" class="category-header w-full text-left p-4 bg-cigar-light/70 text-cigar-dark font-bold text-xl flex justify-between items-center hover:bg-cigar-light transition duration-300" data-target="#${categoryId}-body">
                            <span>${category.category}</span>
                            <span class="text-sm font-medium text-gray-700">æ€»æƒé‡: ${categoryTotalWeight}</span>
                        </button>

                        <!-- Category Body -->
                        <div id="${categoryId}-body" class="p-6 space-y-8">
                `;

                // 3. éå†è¯„åˆ†æ ‡å‡† Criteria
                category.criteriaList.forEach((criteria, critIndex) => {
                    const criteriaName = `crit-${catIndex}-${critIndex}`;
                    
                    let criteriaHtml = `
                        <!-- Single Criteria Block -->
                        <div>
                            <p class="text-lg font-semibold text-cigar-dark mb-3">
                                ${critIndex + 1}. ${criteria.name} 
                                <span class="text-accent text-sm ml-2">(${criteria.weight} åˆ†æƒé‡)</span>
                                <span id="${criteriaName}-score" class="float-right text-gray-500 font-normal">æœªé€‰æ‹©</span>
                            </p>
                            <div class="flex flex-wrap gap-3">
                    `;

                    // 4. éå†è¯„åˆ†é€‰é¡¹ Options (Radio Buttons)
                    criteria.options.forEach((option, optIndex) => {
                        const optionId = `${criteriaName}-${optIndex}`;
                        
                        criteriaHtml += `
                            <label for="${optionId}" class="flex items-center p-3 rounded-lg border border-gray-300 cursor-pointer transition duration-200 hover:border-accent hover:shadow-md bg-white">
                                <input type="radio" id="${optionId}" name="${criteriaName}" value="${criteria.weight * option.scorePct}" data-weight="${criteria.weight}" data-score-pct="${option.scorePct}" class="w-4 h-4 text-accent border-gray-300 focus:ring-accent" required>
                                <span class="ml-2 text-sm font-medium text-gray-700">${option.description} 
                                    <span class="text-xs text-gray-500">(${Math.round(option.scorePct * 100)}%)</span>
                                </span>
                            </label>
                        `;
                    });

                    criteriaHtml += `
                            </div>
                        </div>
                        <!-- Separator -->
                        ${critIndex < category.criteriaList.length - 1 ? '<div class="border-t border-gray-100 my-4"></div>' : ''}
                    `;
                    categoryHtml += criteriaHtml;
                });

                categoryHtml += `
                        </div>
                    </div>
                `;
                ratingFormContainer.innerHTML += categoryHtml;
            });
            
            // æ·»åŠ  Radio Button ç›‘å¬å™¨ï¼Œç”¨äºå®æ—¶æ˜¾ç¤ºå•é¡¹å¾—åˆ†
            ratingFormContainer.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const selectedRadio = e.target;
                    const score = parseFloat(selectedRadio.value);
                    const weight = parseFloat(selectedRadio.getAttribute('data-weight'));
                    const scorePct = parseFloat(selectedRadio.getAttribute('data-score-pct'));
                    
                    const criteriaName = selectedRadio.name;
                    const scoreDisplay = document.getElementById(`${criteriaName}-score`);
                    
                    if (scoreDisplay) {
                        scoreDisplay.textContent = `å¾—åˆ†: ${score.toFixed(2)} / ${weight.toFixed(2)}`;
                        scoreDisplay.classList.remove('text-gray-500');
                        scoreDisplay.classList.add('text-green-600');
                    }
                });
            });

            // æ·»åŠ æ‰‹é£ç´ï¼ˆAccordionï¼‰åŠŸèƒ½
            ratingAppSection.querySelectorAll('.category-header').forEach(header => {
                const targetId = header.getAttribute('data-target');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    // é»˜è®¤å±•å¼€ç¬¬ä¸€ä¸ªç±»åˆ«ï¼Œéšè—å…¶ä»–
                    if (catIndex === 0) {
                        targetElement.classList.remove('hidden');
                    } else {
                        targetElement.classList.add('hidden');
                    }

                    header.addEventListener('click', () => {
                        targetElement.classList.toggle('hidden');
                        // å¯é€‰ï¼šæ·»åŠ æ—‹è½¬å›¾æ ‡ï¼Œä½†è¿™é‡Œæˆ‘ä¿æŒç®€å•ä¸åŠ å›¾æ ‡ï¼Œå› ä¸º Tailwind æ²¡æœ‰å†…ç½®æ—‹è½¬ class
                    });
                }
            });
        }


        // 6. å‡½æ•°ï¼šè®¡ç®—æœ€ç»ˆè¯„åˆ†
        function calculateFinalScore() {
            let totalScore = 0;
            let totalPossibleWeight = 0;
            let missingSelections = 0;

            // éå†æ‰€æœ‰è¯„åˆ†æ ‡å‡†ç»„
            currentConfig.ratingCriteria.forEach((category, catIndex) => {
                category.criteriaList.forEach((criteria, critIndex) => {
                    const criteriaName = `crit-${catIndex}-${critIndex}`;
                    const radioGroup = document.getElementsByName(criteriaName);
                    
                    const selectedOption = Array.from(radioGroup).find(radio => radio.checked);

                    if (selectedOption) {
                        totalScore += parseFloat(selectedOption.value);
                    } else {
                        missingSelections++;
                    }
                    totalPossibleWeight += criteria.weight;
                });
            });

            if (missingSelections > 0) {
                showCustomMessage('âš ï¸ è­¦å‘Š', `æ‚¨è¿˜æœ‰ ${missingSelections} ä¸ªè¯„åˆ†é¡¹æœªé€‰æ‹©ï¼è¯·å®Œæ•´å¡«å†™ã€‚`, 'error');
                finalScoreDisplay.textContent = '0.0';
                return;
            }

            // æ ¼å¼åŒ–è¾“å‡º
            finalScoreDisplay.textContent = totalScore.toFixed(2);
            // è¿™é‡Œä¹Ÿå¯ä»¥æ ¹æ®æ€»å¾—åˆ†åŒ¹é…åˆ° P.I.S.T.A.C.H.O. ç­‰çº§ï¼Œä½†æš‚æ—¶åªæ˜¾ç¤ºåˆ†æ•°
            showCustomMessage('è®¡ç®—å®Œæˆ', `æ€»å¾—åˆ†: ${totalScore.toFixed(2)} / ${totalPossibleWeight.toFixed(2)}`, 'success');

            console.log(`æœ€ç»ˆå¾—åˆ†: ${totalScore.toFixed(2)} / ${totalPossibleWeight.toFixed(2)}`);
        }

        // 7. å‡½æ•°ï¼šåº”ç”¨é…ç½® (ä»ä¸Šä¸€ç‰ˆæœ¬ç»§æ‰¿)
        function applyConfig() {
            try {
                const newConfigString = configTextarea.value;
                const newConfig = JSON.parse(newConfigString);

                if (!newConfig.ratingCriteria || !Array.isArray(newConfig.ratingCriteria)) {
                    throw new Error("JSONç»“æ„æ— æ•ˆï¼šç¼ºå°‘ 'ratingCriteria' æ•°ç»„ã€‚");
                }

                currentConfig = newConfig;

                systemSubtitle.textContent = newConfig.appTitle || "å°†ä¸»è§‚å°è±¡è½¬åŒ–ä¸ºå®¢è§‚æ•°æ®ï¼Œä¸“ä¸šã€ç³»ç»Ÿåœ°è®°å½•æ¯ä¸€æ”¯é›ªèŒ„çš„ç‹¬ç‰¹ä½“éªŒã€‚";
                configStatus.textContent = `çŠ¶æ€ï¼šå·²æˆåŠŸåŠ è½½è‡ªå®šä¹‰é…ç½® (v${newConfig.version || 'Custom'})`;
                configStatus.classList.remove('text-red-500', 'text-gray-500');
                configStatus.classList.add('text-green-600');
                
                showCustomMessage('é…ç½®æ›´æ–°æˆåŠŸ', 'æ–°çš„è¯„åˆ†æ ‡å‡†å·²åº”ç”¨åˆ°å½“å‰ä¼šè¯ä¸­ï¼Œè¯·ç‚¹å‡»â€œå¼€å§‹è¯„åˆ†â€æŸ¥çœ‹ã€‚', 'success');

            } catch (error) {
                configStatus.textContent = `çŠ¶æ€ï¼šé…ç½®åŠ è½½å¤±è´¥ï¼è¯·æ£€æŸ¥ JSON æ ¼å¼ã€‚é”™è¯¯: ${error.message}`;
                configStatus.classList.remove('text-green-600');
                configStatus.classList.add('text-red-500');
                console.error("é…ç½®åŠ è½½é”™è¯¯:", error);
                showCustomMessage('é…ç½®åŠ è½½å¤±è´¥', 'è¯·æ£€æŸ¥ JSON æ ¼å¼æ˜¯å¦æ­£ç¡®æˆ–ç»“æ„æ˜¯å¦å®Œæ•´ã€‚', 'error');
            }
        }

        // 8. å‡½æ•°ï¼šæ˜¾ç¤ºè‡ªå®šä¹‰æ¶ˆæ¯æ¡†ï¼ˆæ›¿ä»£ alert/confirmï¼‰
        function showCustomMessage(title, message, type) {
            let msgBox = document.getElementById('custom-message-box');
            if (!msgBox) {
                msgBox = document.createElement('div');
                msgBox.id = 'custom-message-box';
                msgBox.className = 'fixed top-4 right-4 z-50 p-4 rounded-lg shadow-xl text-white transform transition-transform duration-500 ease-out';
                document.body.appendChild(msgBox);
            }
            
            msgBox.innerHTML = `<strong>${title}</strong><p class="text-sm mt-1">${message}</p>`;

            // æ ¹æ®ç±»å‹è®¾ç½®æ ·å¼
            if (type === 'success') {
                msgBox.style.backgroundColor = '#10B981'; // Tailwind Green-500
            } else if (type === 'error') {
                msgBox.style.backgroundColor = '#EF4444'; // Tailwind Red-500
            } else {
                msgBox.style.backgroundColor = '#3B82F6'; // Tailwind Blue-500
            }

            // æ˜¾ç¤ºå¹¶è‡ªåŠ¨éšè—
            msgBox.style.transform = 'translateY(0)';
            msgBox.style.opacity = '1';

            setTimeout(() => {
                msgBox.style.transform = 'translateY(-100px)';
                msgBox.style.opacity = '0';
            }, 4000);
        }

        // 9. åˆå§‹åŒ–å’Œäº‹ä»¶ç›‘å¬
        window.onload = function() {
            // åˆå§‹åŒ– JSON æ–‡æœ¬æ¡†å†…å®¹
            configTextarea.value = JSON.stringify(DEFAULT_CONFIG_JSON, null, 2);
            configStatus.textContent = `çŠ¶æ€ï¼šå·²åŠ è½½é»˜è®¤é…ç½® (v${DEFAULT_CONFIG_JSON.version})`;
            configStatus.classList.add('text-gray-500');

            // ç›‘å¬ç§»åŠ¨ç«¯èœå•æŒ‰é’®
            menuButton.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
            });

            // ç›‘å¬å¼€å§‹è¯„åˆ†æŒ‰é’® (æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯)
            startRatingBtnDesktop.addEventListener('click', (e) => {
                e.preventDefault();
                switchView('rating');
            });
            startRatingBtnMobile.addEventListener('click', (e) => {
                e.preventDefault();
                switchView('rating');
            });

            // ç›‘å¬è®¡ç®—è¯„åˆ†æŒ‰é’®
            calculateScoreBtn.addEventListener('click', (e) => {
                e.preventDefault();
                calculateFinalScore();
            });


            // ç›‘å¬åº”ç”¨é…ç½®æŒ‰é’®
            applyConfigBtn.addEventListener('click', applyConfig);

            // ç›‘å¬é…ç½®åŒºåŸŸçš„æŠ˜å æŒ‰é’®
            toggleConfigBtn.addEventListener('click', function() {
                const isHidden = configContent.classList.toggle('hidden');
                if (isHidden) {
                    configArrow.classList.remove('rotate-180');
                } else {
                    configArrow.classList.add('rotate-180');
                }
            });
        };
    </script>
</body>
</html>
